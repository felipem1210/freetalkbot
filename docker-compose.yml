version: '3.7'

services:
  asterisk:
    platform: linux/amd64
    image: mlan/asterisk:full
    network_mode: host
    cap_add:
      - sys_ptrace
      - net_admin
      - net_raw
    environment:
      - SYSLOG_LEVEL=${SYSLOG_LEVEL-4}
      - HOSTNAME=asterisk.docker.localhost
    volumes:
      - asterisk-conf:/srv
      - ./asterisk/container-config:/etc/asterisk
      - ./pulse:/run/pulse:rshared
      - /etc/localtime:/etc/localtime:ro

  rasa:
    build:
      context: ./rasa
    env_file:
      - .env
    volumes:
      - ./rasa:/app
    command: 
      - run
      - --enable-api 
      - --cors 
      - "*"
    ports:
      - "5005:5005"
    networks:
      - freetalkbot

  rasa-actions-server:
    image: khalosa/rasa-aarch64:3.5.2
    env_file:
      - .env
    volumes:
      - ./rasa:/app
    command: 
      - run 
      - actions
    ports:
      - "5055:5055"
    networks:
      - freetalkbot

volumes:
  asterisk-conf:

networks:
  freetalkbot:
    driver: bridge